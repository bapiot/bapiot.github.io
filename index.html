<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yapay Zekâ Destekli İHA Projesi - Kontrol Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Özel Stil Blokları -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }
        .gantt-chart-container {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 8px;
        }
        .gantt-grid {
            display: grid;
            grid-template-columns: repeat(52, minmax(0, 1fr)); /* 52 Haftalık Plan */
            gap: 1px;
            padding: 8px 0;
        }
        .gantt-bar {
            grid-column: auto;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            font-size: 0.6rem;
        }
        .gantt-bar:hover {
            transform: scale(1.02);
            opacity: 1 !important;
        }
        .gantt-bar-dimmed {
             opacity: 0.3;
             filter: grayscale(80%);
        }
        .gantt-label {
            height: 40px; 
            display: flex;
            align-items: center;
            padding-left: 8px;
        }
        .header-underline {
            position: relative;
            padding-bottom: 8px;
        }
        .header-underline::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: #0284c7;
        }
        .task-card.highlight {
            transform: scale(1.03);
            box-shadow: 0 0 25px rgba(2, 132, 199, 0.4);
            border-color: #0284c7;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
        .bg-bm { background-color: #0ea5e9; } /* sky-500 */
        .border-bm { border-left-color: #0ea5e9; }
        .bg-eem { background-color: #10b981; } /* emerald-500 */
        .border-eem { border-left-color: #10b981; }
        .filter-active {
            background-color: #0284c7 !important;
            color: white !important;
        }
        .completed-task .accordion-header {
            background-color: #f0fdf4; /* green-50 */
        }
        .sub-task-label {
            transition: color 0.3s;
        }
        .sub-task-checkbox:checked + .sub-task-label {
            color: #16a34a; /* green-700 */
            text-decoration: line-through;
        }
        .accordion-icon {
            transition: transform 0.3s ease;
        }
        .accordion-icon.rotate-45 {
            transform: rotate(45deg);
        }
    </style>
    <!-- Firebase SDK Imports ve Yapılandırma -->
    <script type="module">
        // Sürüm 11.6.1 ile uyumluluğu sağlamak için import'lar güncellendi
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firestore ve Auth nesneleri için global erişim sağlamak için window'a atanır
        window.firebaseApp = null;
        window.db = null;
        window.auth = null;
        window.userId = null;
        
        // Ortamdan gelen zorunlu global değişkenler
        window.appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        setLogLevel('Debug'); 

        async function initializeFirebaseAndAuth() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config eksik. Veri kalıcılığı devre dışı.");
                    document.getElementById('user-id-display').textContent = "Veri Kayıt Kapalı (Config Yok)";
                    return;
                }

                window.firebaseApp = initializeApp(firebaseConfig);
                window.db = getFirestore(window.firebaseApp);
                window.auth = getAuth(window.firebaseApp);
                
                await new Promise(resolve => {
                    onAuthStateChanged(window.auth, async (user) => {
                        if (user) {
                            window.userId = user.uid;
                        } else {
                            try {
                                if (initialAuthToken) {
                                    await signInWithCustomToken(window.auth, initialAuthToken);
                                } else {
                                    await signInAnonymously(window.auth);
                                }
                                window.userId = window.auth.currentUser ? window.auth.currentUser.uid : 'fallback-anonymous';
                            } catch (error) {
                                console.error("Kimlik Doğrulama Başarısız:", error);
                                window.userId = 'unauthenticated-error';
                            }
                        }
                        document.getElementById('user-id-display').textContent = `Kullanıcı: ${window.userId.substring(0, 8)}...`;
                        resolve();
                    });
                });
                
                // Başarılı kimlik doğrulamadan sonra Firestore dinleyicileri kurulur
                if (window.userId && window.db) {
                     setupFirestoreListeners();
                }

            } catch (e) {
                console.error("Firebase başlatma başarısız:", e);
                document.getElementById('user-id-display').textContent = "Veritabanı Başlatılamadı";
            }
        }
        
        // Ana görev kartının (Accordion) alt görev durumuna göre UI'ını günceller
        window.updateTaskCardUI = (taskId, subTaskStatus) => {
             const taskCard = document.getElementById(`task-card-${taskId}`);
             const mainCheckbox = document.getElementById(`completed-A${taskId}`);
             const currentTaskDetails = window.projectData.details.find(d => d.id === taskId);
             
             if (!taskCard || !currentTaskDetails) return;

             let allSubTasksCompleted = true;
             
             // currentTaskDetails'teki tüm alt görevlerin status objesinde true olup olmadığını kontrol et
             currentTaskDetails.subTasks.forEach(subTask => {
                 if (subTaskStatus[subTask.key] !== true) {
                     allSubTasksCompleted = false;
                 }
             });

             if (mainCheckbox) {
                 mainCheckbox.checked = allSubTasksCompleted; 
             }
             
             if (allSubTasksCompleted) {
                 taskCard.classList.add('completed-task');
             } else {
                 taskCard.classList.remove('completed-task');
             }
        }

        // Firestore'dan gerçek zamanlı veri çekme
        async function setupFirestoreListeners() {
            // Veri yolu: /artifacts/{appId}/public/data/project_tracking/{taskId}
            const collectionRef = collection(window.db, `artifacts/${window.appId}/public/data/project_tracking`);
            
            // onSnapshot ile gerçek zamanlı dinleme
            onSnapshot(collectionRef, (snapshot) => {
                snapshot.docChanges().forEach(change => {
                    const data = change.doc.data();
                    const taskId = change.doc.id;

                    const notesArea = document.getElementById(`notes-A${taskId}`);
                    const subTaskStatus = data.subTaskStatus || {};
                    const currentTaskDetails = window.projectData.details.find(d => d.id === taskId);
                    
                    if (currentTaskDetails && currentTaskDetails.subTasks) {
                        currentTaskDetails.subTasks.forEach(subTask => {
                            const subCheckbox = document.getElementById(`sub-A${subTask.key}`);
                            if (subCheckbox) {
                                // Firestore'dan gelen veriyi UI'a uygula
                                // Checkbox'ın durumunu sadece veri gelirse değiştir, yoksa false kalsın.
                                subCheckbox.checked = subTaskStatus[subTask.key] === true;
                            }
                        });
                    }

                    if (notesArea) {
                         notesArea.value = data.notes || '';
                    }

                    // Alt görev durumlarına göre ana kartı güncelle
                    window.updateTaskCardUI(taskId, subTaskStatus);
                });
                console.log("Firestore'dan Görev Durumu Güncellendi.");
            }, (error) => {
                console.error("Firestore Dinleme Hatası:", error);
            });
        }
        
        // Firestore'a veri kaydetme
        window.saveTaskStatus = async (taskId, field, value) => {
            if (!window.db || !window.userId) {
                console.warn("Veritabanı veya Kullanıcı ID'si hazır değil.");
                return;
            }
            try {
                // Ortak (public) yola kaydetme
                const docRef = doc(window.db, `artifacts/${window.appId}/public/data/project_tracking`, taskId);
                
                let updateData = {};
                if (field === 'notes') {
                    // Not alanını kaydet
                    updateData = { notes: value };
                } else if (field.startsWith('sub-')) {
                    // Alt görevi (subTaskStatus haritası içinde) kaydet
                    const subTaskKey = field.substring(4); 
                    updateData = { subTaskStatus: { [subTaskKey]: value } };
                }
                
                // merge: true ile sadece belirtilen alanları günceller
                await setDoc(docRef, updateData, { merge: true });
                console.log(`Görev ${taskId} - ${field} kaydedildi.`);
                
            } catch (e) {
                console.error("Görev durumu kaydetme hatası:", e);
            }
        }
        
        window.initializeFirebaseAndAuth = initializeFirebaseAndAuth;

    </script>
</head>
<body class="text-slate-800">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-md">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-slate-900">
                🚀 <span class="hidden sm:inline">İHA Projesi Kontrol Paneli</span>
            </h1>
            <nav class="hidden md:flex space-x-6 text-base font-medium">
                <a href="#proje-akisi" class="text-slate-600 hover:text-sky-600 transition">Proje Akışı</a>
                <a href="#gorev-dagilimi" class="text-slate-600 hover:text-sky-600 transition">Görev Dağılımı</a>
                <a href="#teknik-detaylar" class="text-slate-600 hover:text-sky-600 transition">Teknik Detaylar</a>
            </nav>
            <div class="flex items-center gap-4">
                 <!-- Kullanıcı ID'si (Hangi kullanıcının veri kaydettiğini gösterir) -->
                 <span id="user-id-display" class="text-xs text-slate-500 bg-slate-100 p-2 rounded-lg font-mono">Veri Kaydı Başlatılıyor...</span>
                 <div id="mobile-menu-button" class="md:hidden text-2xl cursor-pointer">☰</div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white px-6 pb-4">
             <a href="#proje-akisi" class="block py-2 text-slate-600 hover:text-sky-600 transition">Proje Akışı</a>
             <a href="#gorev-dagilimi" class="block py-2 text-slate-600 hover:text-sky-600 transition">Görev Dağılımı</a>
             <a href="#teknik-detaylar" class="block py-2 text-slate-600 hover:text-sky-600 transition">Teknik Detaylar</a>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <section id="proje-akisi" class="mb-12">
            <h2 class="text-3xl font-bold mb-6 header-underline">Proje Akışı ve Zaman Çizelgesi</h2>
            <p class="mb-8 text-slate-600 max-w-3xl">Proje, 4 ana faza yayılmıştır ve toplam 52 hafta (1 yıl) sürmesi hedeflenmiştir. Aşağıdaki interaktif zaman çizelgesi, görevlerin haftalık dağılımını, sürelerini ve birbirleriyle olan ilişkilerini göstermektedir. Bir görevin detaylarını görmek için üzerine tıklayabilirsiniz.</p>
            
            <div class="bg-white p-6 rounded-2xl shadow-lg overflow-x-auto">
                <div class="min-w-[1200px]">
                    <div class="gantt-chart-container mb-2">
                        <div></div>
                        <div class="gantt-grid text-xs text-center text-slate-500">
                            <!-- Gantt Headers will be generated by JS -->
                        </div>
                    </div>
                    <div id="gantt-chart" class="gantt-chart-container">
                        <!-- Gantt Rows will be generated by JS -->
                    </div>
                </div>
                 <div class="mt-4 flex flex-wrap gap-4 text-sm">
                    <div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-bm"></div><span>Bilgisayar Müh. (BM)</span></div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-eem"></div><span>Elektrik-Elektronik Müh. (EEM)</span></div>
                </div>
            </div>
        </section>

        <section id="gorev-dagilimi" class="mb-12">
            <h2 class="text-3xl font-bold mb-6 header-underline">Disipline Göre Görev Dağılımı</h2>
             <p class="mb-8 text-slate-600 max-w-3xl">Her ekip üyesinin projedeki ana odak alanları ve sorumlulukları aşağıda özetlenmiştir. Bir roldeki görevleri zaman çizelgesinde vurgulamak için ilgili butona tıklayın.</p>
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Role cards will be generated by JS -->
            </div>
        </section>

        <section id="teknik-detaylar">
            <h2 class="text-3xl font-bold mb-6 header-underline">Teknik Detaylar ve İş Paketleri (Firestore Destekli Takip)</h2>
            <p class="mb-8 text-slate-600 max-w-3xl">Her bir iş paketinin (İP) detayları, çıktıları ve başarı kriterleri. Aşağıdaki kutucukları işaretleyerek ve not ekleyerek görev durumunu **kalıcı olarak kaydedebilirsiniz** (Firebase Firestore).</p>
            <div id="accordion-container" class="space-y-4">
                <!-- Accordion items will be generated by JS -->
            </div>
        </section>

    </main>
    
    <footer class="text-center py-8 text-slate-500 text-sm">
        <p>Yapay Zekâ Destekli İHA Projesi Kontrol Paneli | Abdullah Gül Üniversitesi</p>
    </footer>

<script>
    window.projectData = {
        tasks: [
            { id: 'A', name: 'Mekanik Montaj ve Kablolama', sorumlu: 'EEM 1', start: 1, duration: 6, dep: [], discipline: 'eem' },
            { id: 'E', name: 'Simülasyon Ortamı Kurulumu', sorumlu: 'BM 1', start: 1, duration: 6, dep: [], discipline: 'bm' },
            { id: 'B', name: 'Uçuş Kontrol ve Kalibrasyon', sorumlu: 'EEM 1', start: 7, duration: 5, dep: ['A'], discipline: 'eem' },
            { id: 'D', name: 'IoFT Haberleşme Altyapısı', sorumlu: 'BM 2 / EEM 2', start: 7, duration: 8, dep: ['A'], discipline: 'eem' },
            { id: 'C', name: 'Yapay Zekâ (Görüntü İşleme)', sorumlu: 'BM 1', start: 7, duration: 10, dep: ['E'], discipline: 'bm' },
            { id: 'F', name: 'Otonom Güdüm ve Dalış Algoritması', sorumlu: 'BM 2', start: 17, duration: 10, dep: ['C', 'E'], discipline: 'bm' },
            { id: 'G', name: 'Simülasyon Entegrasyonu ve Testleri', sorumlu: 'BM 2 (Lider)', start: 27, duration: 8, dep: ['C', 'D', 'F'], discipline: 'bm' },
            { id: 'H1', name: 'Temel Uçuş & Donanım Testleri', sorumlu: 'EEM 1 / EEM 2', start: 35, duration: 4, dep: ['B', 'G'], discipline: 'eem' },
            { id: 'H2', name: 'Entegre Saha Görev Testleri', sorumlu: 'EEM 1 (Lider)', start: 39, duration: 8, dep: ['H1'], discipline: 'eem' },
            { id: 'I', name: 'Analiz, Raporlama ve Makale Taslağı', sorumlu: 'BM 1 (Lider)', start: 47, duration: 6, dep: ['H2'], discipline: 'bm' }
        ],
        roles: [
            { 
                id: 'bm1',
                title: 'BM 1: Görüntü İşleme & Simülasyon', 
                icon: '🧠',
                tasks: ['E', 'C', 'I'],
                description: 'Yapay zekâ, görüntü işleme algoritmaları ve projenin sanal test ortamının kurulumundan sorumludur.'
            },
            { 
                id: 'bm2',
                title: 'BM 2: Otonom Güdüm & Ağ Yazılımı', 
                icon: '💻',
                tasks: ['D', 'F', 'G'],
                description: 'İHA\'ların otonom hareket algoritmaları, aralarındaki iletişim yazılımı ve tüm sistemin entegrasyonundan sorumludur.'
            },
            { 
                id: 'eem1',
                title: 'EEM 1: Mekanik & Uçuş Kontrol', 
                icon: '🛠️',
                tasks: ['A', 'B', 'H1', 'H2'],
                description: 'İHA\'ların fiziksel montajı, uçuş kontrol kartlarının ayarlanması ve saha testlerinin liderliğinden sorumludur.'
            },
            { 
                id: 'eem2',
                title: 'EEM 2: Haberleşme & Sensörler', 
                icon: '⚡',
                tasks: ['D', 'G', 'H1', 'H2'],
                description: 'Haberleşme donanımları, kamera ve sensörlerin entegrasyonu ile saha testleri sırasında veri takibinden sorumludur.'
            }
        ],
        details: [
            { 
                id: 'A', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> İki adet sabit kanatlı İHA platformunun fiziksel olarak uçuşa hazır hale getirilmesi ve aviyonik bileşenlerin montajının tamamlanması.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>İHA Gövdelerinin Mekanik Montaj Raporu.</li><li>Motor, ESC (SkyWalker 80A), Servo motor (MG90S) ve güç sistemlerinin (14.8V Lipo Batarya, UBEC) güvenli kablolama diyagramı ve test protokolü.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> Tüm donanım bileşenlerinin (Motor, ESC, Servo) RC Kumanda ile manuel olarak kontrol edilebilir ve test voltajlarında sorunsuz çalışabilir durumda olması.
                `,
                subTasks: [
                    { key: 'A1', description: 'Mekanik Montajın Tamamlanması ve Test Raporu' },
                    { key: 'A2', description: 'Motor, ESC ve Servo Kablolamasının Güvenlik Kontrolü' },
                    { key: 'A3', description: 'Güç Sistemlerinin (Batarya, UBEC) İlk Çalıştırma Testi' }
                ]
            },
            { 
                id: 'E', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> Projenin algoritmik geliştirme ve ön test aşamaları için gerçekçi bir sanal ortamın kurulması.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>Görev bilgisayarlarında (RPi/Jetson) ROS2 (Robot Operating System 2) ve Gazebo simülasyon yazılımlarının stabil kurulumu.</li><li>Sabit kanatlı İHA (Keşif/Kamikaze) modellerinin Gazebo ortamına entegrasyonu. Sanal gimbal, GPS ve kamera arayüzlerinin ROS2 topic'ler üzerinden çalışır hale getirilmesi.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> İki İHA modelinin de Gazebo'da otonom uçuşa uygun bir şekilde simüle edilebilir ve ROS2 üzerinden kontrol edilebilir olması.
                `,
                subTasks: [
                    { key: 'E1', description: 'ROS2 ve Gazebo Kurulumu' },
                    { key: 'E2', description: 'İHA Modellerinin Gazebo\'ya Entegrasyonu' },
                    { key: 'E3', description: 'Sanal Sensör ve Kontrol Arayüzlerinin ROS2 Üzerinde Doğrulanması' }
                ]
            },
            { 
                id: 'B', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> Pixhawk otopilotların uçuşa hazırlanması ve temel stabilite ayarlarının yapılması.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>PX4 uçuş kontrol yazılımının yüklenmesi ve tüm sensör (IMU, GPS, Pusula) kalibrasyonlarının tamamlanması.</li><li>Uçuş modlarının (Stabilize, Otonom, Görev) ayarlanması ve RC Kumanda ile tam uyumluluk testi.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> İHA'ların yer testlerinde (motor, kontrol yüzeyleri) hatasız tepki vermesi ve Pixhawk'ın uçuş öncesi tüm kontrol listelerini (pre-flight checks) geçmesi.
                `,
                 subTasks: [
                    { key: 'B1', description: 'PX4 Yazılım Yüklemesi ve Sensör Kalibrasyonu' },
                    { key: 'B2', description: 'Uçuş Modları Tanımlanması ve Kontrol Testleri' },
                    { key: 'B3', description: 'RC Kumanda Uyum Testleri ve Güvenlik Kontrolleri' }
                ]
            },
            { 
                id: 'D', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> Merkeziyetsiz İHA-İHA ve İHA-Bulut iletişim altyapısının donanımsal ve yazılımsal olarak kurulması.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>LoRa modüllerinin (SX1262 HAT) ve GSM modülünün (SIM808) görev bilgisayarına entegrasyonu ve sürücü kurulumu.</li><li>İHA-İHA arası koordinat veri paketlerini işleyen ve minimum 50ms gecikmeyi hedefleyen LoRa iletişim protokolü yazılımı.</li><li>Keşif İHA'sından telemetri verilerini bulut platformuna aktaran GSM/MQTT yazılımının geliştirilmesi.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> LoRa üzerinden iki İHA arasında %95 üzeri veri bütünlüğü ile 1 km menzilde veri transferinin sağlanması.
                `,
                subTasks: [
                    { key: 'D1', description: 'LoRa/GSM Donanım ve Sürücü Entegrasyonu' },
                    { key: 'D2', description: 'LoRa İletişim Protokolü Yazılım Geliştirme' },
                    { key: 'D3', description: 'GSM/MQTT Telemetri Aktarım Yazılımı' },
                    { key: 'D4', description: 'İlk Gecikme ve Menzil Testleri' }
                ]
            },
            { 
                id: 'C', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> Yüksek doğrulukta hedef tespiti ve konumlandırma için hibrit yapay zekâ algoritmalarının geliştirilmesi.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>YOLO tabanlı nesne tespit modelinin prototip QR kod tespiti için hazırlanması ve optimizasyonu.</li><li>Görüntüdeki potansiyel hedef bölgelerini hızlıca daraltan Adaptive Thresholding ve kenar algılama ön işlem kodunun yazılması.</li><li>Tespit edilen hedefin kamera parametreleri ve İHA konumu kullanılarak GPS koordinatını ($\mathbf{\pm2}$ metre hassasiyetle) hesaplayan Fotogrametrik Konumlandırma Modülü.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> Simülasyon ortamında QR kod hedeflerini $\mathbf{\%90}$ üzeri doğrulukla ve $\mathbf{\pm2}$ metre konum hassasiyetiyle tespit edebilen entegre yazılım modülü.
                `,
                subTasks: [
                    { key: 'C1', description: 'YOLO Modelinin QR Kod için Eğitilmesi ve Optimizasyonu' },
                    { key: 'C2', description: 'Adaptive Thresholding Ön İşlem Kodunun Geliştirilmesi' },
                    { key: 'C3', description: 'Fotogrametrik Konumlandırma Modülü Yazılımı' }
                ]
            },
            { 
                id: 'F', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> Kamikaze İHA'sının aldığı koordinatlara göre otonom ve kararlı bir saldırı rotası planlayıp icra etmesi.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>Hedef koordinatlarına göre en uygun dalış açısını ve hızını belirleyen Rota Planlama Algoritması.</li><li>PX4'ün güdüm komutları kullanılarak hedefe $\mathbf{\pm5}$ metre hassasiyetle yaklaşmayı sağlayan Otonom Güdüm ve Kontrol Modülü.</li><li>Görev sonrası İHA'nın güvenli irtifaya tırmanmasını ve geri dönmesini sağlayan Kurtarma Prosedürü yazılımı.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> Simülasyon ortamında otonom dalışın hedeften sapma miktarının sürekli olarak $\mathbf{<5}$ metre aralığında kalması.
                `,
                subTasks: [
                    { key: 'F1', description: 'Rota Planlama Algoritması Geliştirilmesi' },
                    { key: 'F2', description: 'Otonom Güdüm ve Kontrol Modülü Yazılımı' },
                    { key: 'F3', description: 'Kurtarma Prosedürü Yazılımı' }
                ]
            },
            { 
                id: 'G', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> Tüm yazılımların (C, D, F) sanal ortamda bir araya getirilerek uçtan uca senaryonun test edilmesi ve optimizasyonu.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>Keşif (Yapay Zekâ) ve Kamikaze (Güdüm) İHA'ları arasındaki veri akışını gösteren Simülasyon Veri Seti.</li><li>Simülasyon Hata Ayıklama Raporu ve Algoritma Optimizasyon Kayıtları.</li><li>Simülasyon Başarı Raporu.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> Simülasyon ortamında Keşif-Tespit-Aktarım-Yaklaşım senaryosunun genel görev başarı oranının $\mathbf{\%90}$ ve üzerinde olması. Bu, saha testleri için ön şarttır.
                `,
                subTasks: [
                    { key: 'G1', description: 'Tüm Yazılımların ROS2/Gazebo Ortamına Entegrasyonu' },
                    { key: 'G2', description: 'Uçtan Uçta Simülasyon Senaryosu Testi' },
                    { key: 'G3', description: 'Hata Ayıklama ve %90 Başarı Oranı Optimizasyonu' }
                ]
            },
            { 
                id: 'H1', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> Sistemin ayrı ayrı temel işlevselliğini gerçek donanım ve uçuş koşullarında doğrulamak.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>Keşif İHA'sının otonom kalkış, belirli bir rotada stabil uçuş ve iniş testleri.</li><li>LoRa/GSM modülleri üzerinden yer istasyonuna kesintisiz telemetri veri aktarım testleri.</li><li>Yerel alan kamerası (QR kod) tespit ve koordinat hesaplama hızının statik yer testleri.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> Her iki İHA'nın da tüm otonom uçuş modlarında stabil ve güvenli şekilde uçuş yapabildiğinin kanıtlanması.
                `,
                subTasks: [
                    { key: 'H1.1', description: 'Keşif İHA Temel Otonom Uçuş Testleri' },
                    { key: 'H1.2', description: 'Kamikaze İHA Temel Otonom Uçuş Testleri' },
                    { key: 'H1.3', description: 'LoRa/GSM Telemetri Aktarımının Saha Doğrulaması' }
                ]
            },
            { 
                id: 'H2', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> Tüm sistemin gerçek uçuş koşullarında entegre olarak tam görev senaryosunu gerçekleştirmesi.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>Gerçek zamanlı hedef tespiti ve aktarımı gecikme (Latency) metrikleri.</li><li>Kamikaze İHA'sının hedefe yaklaşma hassasiyeti (metre bazında sapma) kayıtları.</li><li>Uçuş sırasında elde edilen tüm telemetri ve görev verilerinin veri tabanı kaydı.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> Tam görev senaryosunun tekrarlanabilir şekilde $\mathbf{\%80}$ ve üzeri genel görev başarı oranıyla tamamlanması.
                `,
                 subTasks: [
                    { key: 'H2.1', description: 'Uçtan Uca Saha Testi 1 (Düşük Rüzgar)' },
                    { key: 'H2.2', description: 'Uçtan Uca Saha Testi 2 (Hafif Rüzgar/Değişen Koşullar)' },
                    { key: 'H2.3', description: 'Görev Başarı Oranı ve Hassasiyet Metriklerinin Toplanması' }
                ]
            },
            { 
                id: 'I', 
                content: `<h4 class="font-semibold text-sky-600 mt-2 mb-1">Amaç:</h4> Elde edilen tüm verilerin analiz edilmesi ve projenin bilimsel çıktılarının oluşturulması.
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Temel Çıktılar:</h4> 
                    <ul class="list-disc list-inside ml-4 text-sm"><li>Simülasyon ve Saha Sonuçlarının Karşılaştırmalı Performans Analiz Raporu.</li><li>Proje Sonuç Raporu ve Nihai Proje Sunumu.</li><li>En az 1 adet ulusal/uluslararası konferans bildirisi veya makale taslağı.</li></ul>
                    <h4 class="font-semibold text-sky-600 mt-2 mb-1">Başarı Kriteri:</h4> Tüm hipotezlerin toplanan nicel verilerle desteklenerek veya çürütülerek bilimsel bir dille belgelenmesi.
                `,
                subTasks: [
                    { key: 'I1', description: 'Tüm Saha Verilerinin İstatistiksel Analizi' },
                    { key: 'I2', description: 'Sonuç Raporu Taslağının Hazırlanması' },
                    { key: 'I3', description: 'Makale veya Bildiri Taslağının Oluşturulması' }
                ]
            }
        ]
    };

    document.addEventListener('DOMContentLoaded', () => {
        // Firebase başlatma fonksiyonunu çağır
        window.initializeFirebaseAndAuth().then(() => {
             renderProjectUI(); // Firebase hazır olduğunda UI'ı oluştur
        });


        const ganttChart = document.getElementById('gantt-chart');
        const ganttHeaderContainer = document.querySelector('.gantt-grid');
        const rolesContainer = document.querySelector('#gorev-dagilimi .grid');
        const accordionContainer = document.getElementById('accordion-container');
        
        // Gantt Başlıklarını Oluştur (1'den 52'ye kadar)
        for (let i = 1; i <= 52; i++) {
            const headerCell = document.createElement('div');
            headerCell.textContent = (i % 4 === 0) ? `${i}.H` : '';
            headerCell.className = `text-xs text-center ${(i % 4 === 0) ? 'font-bold' : ''}`;
            ganttHeaderContainer.appendChild(headerCell);
        }

        function renderProjectUI() {
            accordionContainer.innerHTML = '';
            
            // Gantt ve Accordion Öğelerini Oluştur
            window.projectData.tasks.forEach(task => {
                const endLine = task.start + task.duration;
                const label = document.createElement('div');
                label.className = 'gantt-label bg-slate-50 rounded-l-lg font-medium text-sm text-slate-700';
                label.textContent = `İP ${task.id}`;

                const grid = document.createElement('div');
                grid.className = 'gantt-grid';

                const bar = document.createElement('div');
                bar.className = `gantt-bar bg-${task.discipline} text-white flex items-center justify-center p-1 rounded-lg h-[40px] shadow`;
                bar.style.gridColumn = `${task.start} / ${endLine}`; 
                bar.textContent = task.name;
                bar.dataset.taskId = task.id;
                bar.dataset.discipline = task.discipline;

                grid.appendChild(bar);
                ganttChart.appendChild(label);
                ganttChart.appendChild(grid);
                
                // Accordion Item
                const detail = window.projectData.details.find(d => d.id === task.id);
                const accordionItem = document.createElement('div');
                accordionItem.id = `task-card-${task.id}`;
                accordionItem.className = `task-card bg-white rounded-2xl shadow-lg border-l-8 border-${task.discipline} transition-all duration-300 overflow-hidden`;

                let subTasksHtml = '';
                if (detail && detail.subTasks && detail.subTasks.length > 0) {
                    subTasksHtml = `
                        <h5 class="font-bold text-lg text-slate-700 mb-3 mt-4">Detaylı Çıktılar / Alt Görevler:</h5>
                        <div class="space-y-2 mb-4">
                    `;
                    detail.subTasks.forEach(subTask => {
                        // Checkbox'ın onchange olayı window.saveTaskStatus'u çağırarak Firestore'a kaydediyor
                        subTasksHtml += `
                            <div class="flex items-start">
                                <input type="checkbox" id="sub-A${subTask.key}" data-task-id="${task.id}" class="sub-task-checkbox h-5 w-5 text-green-600 border-gray-300 rounded focus:ring-green-500 cursor-pointer mt-1" 
                                       onchange="window.saveTaskStatus('${task.id}', 'sub-${subTask.key}', this.checked);">
                                <label for="sub-A${subTask.key}" class="sub-task-label ml-3 text-base text-slate-700 cursor-pointer">${subTask.description}</label>
                            </div>
                        `;
                    });
                    subTasksHtml += '</div>';
                }

                accordionItem.innerHTML = `
                    <div class="accordion-header p-5 cursor-pointer flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <h3 class="font-bold text-lg">${task.id}: ${task.name}</h3>
                            <span class="text-sm text-slate-500">| Sorumlu: ${task.sorumlu} | Süre: ${task.duration} Hafta</span>
                        </div>
                        <span class="text-2xl font-light text-slate-500 accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <div class="p-5 pt-0 text-slate-600">
                             <!-- Detaylı İçerik -->
                             ${detail.content}
                             
                             <div class="mt-6 pt-4 border-t border-slate-200">
                                <h5 class="font-bold text-lg text-slate-700 mb-3">Görev Takibi (Kalıcı Kayıt)</h5>
                                
                                ${subTasksHtml}

                                <div class="flex items-start gap-4 mb-4 pt-4 border-t border-slate-100">
                                    <!-- Ana görev tamamlama kutucuğu, alt görevler bitince JS ile otomatik işaretlenir -->
                                    <input type="checkbox" id="completed-A${task.id}" data-task-id="${task.id}" class="h-6 w-6 text-green-600 border-gray-300 rounded focus:ring-green-500 cursor-pointer" disabled>
                                    <label for="completed-A${task.id}" class="text-lg font-medium text-green-700">İş Paketi Tamamlandı (Tüm Alt Görevler Bitince Otomatik)</label>
                                </div>
                                <label for="notes-A${task.id}" class="block text-sm font-medium text-slate-700 mb-1">Görev Notları (Maksimum 500 karakter):</label>
                                <!-- Not alanı onchange ile Firestore'a kaydediliyor -->
                                <textarea id="notes-A${task.id}" data-task-id="${task.id}" rows="4" maxlength="500"
                                          class="w-full border border-slate-300 rounded-lg p-3 text-sm focus:border-sky-500 focus:ring-sky-500 transition"
                                          onchange="window.saveTaskStatus('${task.id}', 'notes', this.value);"></textarea>
                            </div>
                        </div>
                    </div>
                `;
                accordionContainer.appendChild(accordionItem);
            });

            // Rol Kartlarını Oluştur
            window.projectData.roles.forEach(role => {
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-2xl shadow-lg flex flex-col';
                card.innerHTML = `
                    <div class="flex items-center gap-4 mb-4">
                        <span class="text-4xl">${role.icon}</span>
                        <h3 class="text-xl font-bold">${role.title}</h3>
                    </div>
                    <p class="text-slate-600 mb-4 flex-grow">${role.description}</p>
                    <button data-role-id="${role.id}" class="filter-btn mt-auto w-full bg-slate-200 text-slate-700 font-bold py-2 px-4 rounded-lg transition hover:bg-sky-200">
                        Görevleri Vurgula
                    </button>
                `;
                rolesContainer.appendChild(card);
            });
            
            // UI Etkileşimlerini Tanımla (Accordion, Gantt Tıklama ve Filtreleme)
            accordionContainer.addEventListener('click', (e) => {
                const header = e.target.closest('.accordion-header');
                if (!header) return;

                const accordionItem = header.parentElement;
                const content = accordionItem.querySelector('.accordion-content');
                const icon = header.querySelector('.accordion-icon');
                const isOpen = content.style.maxHeight;
                
                // Diğerlerini kapat
                accordionContainer.querySelectorAll('.accordion-content').forEach(c => c.style.maxHeight = null);
                accordionContainer.querySelectorAll('.accordion-icon').forEach(i => i.classList.remove('rotate-45'));

                if (!isOpen) {
                    content.style.maxHeight = content.scrollHeight + "px";
                    icon.classList.add('rotate-45');
                }
            });

            ganttChart.addEventListener('click', (e) => {
                const bar = e.target.closest('.gantt-bar');
                if(!bar) return;

                const taskId = bar.dataset.taskId;
                const targetCard = document.getElementById(`task-card-${taskId}`);

                if (targetCard) {
                    document.querySelectorAll('.task-card').forEach(card => card.classList.remove('highlight'));
                    
                    targetCard.classList.add('highlight');
                    targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                    const content = targetCard.querySelector('.accordion-content');
                     if (!content.style.maxHeight) {
                        targetCard.querySelector('.accordion-header').click();
                     }
                }
            });
            
            let activeFilter = null;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const roleId = btn.dataset.roleId;
                    const roleTasks = window.projectData.roles.find(r => r.id === roleId).tasks;
                    const ganttBars = document.querySelectorAll('.gantt-bar');
                    
                    if (activeFilter === roleId) {
                        ganttBars.forEach(bar => bar.classList.remove('gantt-bar-dimmed'));
                        btn.classList.remove('filter-active');
                        activeFilter = null;
                    } else {
                         document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('filter-active'));
                         
                        btn.classList.add('filter-active');
                        activeFilter = roleId;

                        ganttBars.forEach(bar => {
                            if (roleTasks.includes(bar.dataset.taskId)) {
                                bar.classList.remove('gantt-bar-dimmed');
                            } else {
                                bar.classList.add('gantt-bar-dimmed');
                            }
                        });
                    }
                });
            });

            // Mobil Menü Mantığı
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            mobileMenu.addEventListener('click', (e) => {
                if (e.target.tagName === 'A') {
                    mobileMenu.classList.add('hidden');
                }
            });
        }
    });
</script>

</body>
</html>
